var myWHp1,myWHp2,myWHtime,myWHgen,myWHsex,myWHid,myWHbreed,breed1,breed2,gen,sex,cid,count,account,owlWallet,myWHimg=new Array,loaded=!1;const ipfs=IpfsApi({host:"ipfs.infura.io",port:5001,protocol:"https"});var img;async function loadMyOwl(){await contract.methods.PLAYERITEMS(account).call().then(e=>{myWHp1=e[0],myWHp2=e[1],myWHtime=e[2],myWHgen=e[3],myWHsex=e[4],myWHid=e[5],myWHbreed=e[6]});for(let e=0;e<myWHid.length;e++)myWHimg[e]=img[myWHgen[e]][myWHsex[e]],$("#myWH").append('<p id="o'+myWHid[e]+'" class="boxnft"><b>Whooli Hootie #'+myWHid[e]+"</b><br/>Parents ID: "+myWHp1[e]+" + "+myWHp2[e]+"<br/>Last breeded: "+(myWHtime[e]>0?moment(moment.unix(myWHtime[e])).fromNow():"Since forever")+"<br/>Generation: "+myWHgen[e]+" ("+(0==myWHsex[e]?"Female":"Male")+')<br/><video autoplay loop muted src="https://ipfs.io/ipfs/'+myWHimg[e]+(moment.duration(moment().diff(moment(moment.unix(myWHtime[e])))).asSeconds()>0&&1==myWHbreed[e]?'" onclick="loadImg('+e+')" class="nft':'" class="nobreed')+'"></video></p> ')}async function loadImg(e){const t='<video autoplay loop muted onclick="unloadImg()" src="https://ipfs.io/ipfs/'+myWHimg[e]+'" class="nft"></video>';if($("#breed1").is(":empty"))$("#breed1").html(t),breed1=myWHid[e],hideOwls(e);else{if(!$("#breed2").is(":empty"))return;$("#breed2").html(t),breed2=myWHid[e],hideOwls(e)}$("#breed1").is(":empty")||$("#breed2").is(":empty")||($("#breed").show(),await contract.methods.gen(parseInt(myWHgen[e])+1).call().then(e=>{$("#lblBreed").html("("+e[1]+"/"+e[0]+")")}),gen=parseInt(myWHgen[e])+1)}async function hideOwls(e){for(let t=0;t<myWHid.length;t++)myWHsex[t]!=myWHsex[e]&&myWHgen[t]==myWHgen[e]||$("#o"+myWHid[t]).hide(),myWHp1[t]==myWHid[e]&&$("#o"+myWHp2[t]).hide(),myWHp2[t]==myWHid[e]&&$("#o"+myWHp1[t]).hide()}async function unloadImg(){$("#breed1").empty(),$("#breed2").empty(),$("#lblBreed").empty(),breed1=null,breed2=null,$("#breed").hide();for(let e=0;e<myWHid.length;e++)$("#o"+myWHid[e]).show()}async function getCID(){sex=Math.floor(2*Math.random());const e=await new Promise(e=>{const t=new FileReader;t.onloadend=(()=>{ipfs.add(ipfs.Buffer.from(t.result)).then(t=>{e(t)})}),t.readAsArrayBuffer(new File([JSON.stringify({name:"Whooli Hootie #"+(parseInt(count)+1),description:"We are a green chip NFT that gives passive income and many offline perks. Find another gender to breed your baby owl now!",animation_url:"ipfs://"+img[gen][sex],attributes:[{display_type:"number",trait_type:"Generation",value:gen},{trait_type:"Gender",value:0==sex?"Female":"Male"},{trait_type:"Parent 1",value:null==breed1?"":"WHCC #"+breed1},{trait_type:"Parent 2",value:null==breed2?"":"WHCC #"+breed2},{display_type:"date",trait_type:"Hatched date",value:Date.now()}]})],"application/json"))});cid=e[0].hash}async function MINT(){gen=1,await getCID(),await contract.methods.MINT(sex,cid).send({from:account,gas:1e6,value:0}),location.reload()}async function BREED(){await getCID(),await contract.methods.BREED(breed1,breed2,sex,cid).send({from:await account,gas:1e6,value:0}),location.reload()}async function load(){web3=new Web3(ethereum),await window.ethereum.request({method:"eth_requestAccounts"}),4!=await web3.eth.net.getId()?(await ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x4"}]}),location.reload()):(contract=new web3.eth.Contract(abi,"0x1193034262F5466Ac6AE6987aFbc4e93bA1FB07A"),await contract.methods.gen(1).call().then(e=>{$("#mint").append(e[1]+"/"+e[0]+")")}),count=await contract.methods.count.call().call(),await $.getJSON("https://aloycwl.github.io/omg_frontend/whcc/js/img.min.json",function(e){img=e}),contract2=new web3.eth.Contract(abi2,"0x34A85f092877F93584ab9f4fe9aE2FFA8C846B1F"),owlWallet=await contract2.methods.balanceOf("0x15eD406870dB283E810D5885e432d315C94DD0dd").call()/1e18,$("#name").append(await contract.methods.getBalance.call().call()+" balance. Owl Wallet: "+owlWallet))}async function isWeb3(){await web3.eth.getAccounts().then(e=>{account=e[0],e.length>0?($("#connect").hide(),$("#root").show(),0==loaded&&(loadMyOwl(),loaded=!0)):($("#connect").show(),$("#root").hide())})}load(),setInterval(isWeb3,2e3);