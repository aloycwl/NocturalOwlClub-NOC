var breed1,breed2,gen,sex,cid,count,myWH=new Array;const ipfs=IpfsApi({host:"ipfs.infura.io",port:5001,protocol:"https"});async function loadMyOwl(){const e=await contract.methods.getWallet(await getCurrentAccount()).call();for(let n=0;n<e.length;n++){var t;myWH[n]=new Array,await contract.methods.owl(e[n]).call().then(e=>{for(let t=0;t<6;t++)myWH[n][t]=e[t+1]}),await $.getJSON("https://ipfs.io/ipfs/"+myWH[n][5],function(t){myWH[n][6]=t.name,myWH[n][7]=t.image.replace("ipfs://","https://cloudflare-ipfs.com/ipfs/"),myWH[n][8]=e[n]}),await contract.methods.gen(parseInt(myWH[n][3])+1).call().then(e=>{t=parseInt(e[0])>parseInt(e[1])}),$("#myWH").append('<p id="o'+e[n]+'" class="boxnft"><b>'+myWH[n][6]+"</b><br/>Parents ID: "+myWH[n][0]+" + "+myWH[n][1]+"<br/>Last breeded: "+(myWH[n][2]>0?moment(moment.unix(myWH[n][2])).fromNow():"Since forever")+"<br/>Generation: "+myWH[n][3]+" ("+(0==myWH[n][4]?"Female":"Male")+')<br/><img src="'+myWH[n][7]+(moment.duration(moment().diff(moment(moment.unix(myWH[n][2])))).asSeconds()>0&&1==t?'" onclick="loadImg('+n+')" class="nft':'" class="nobreed')+'"></p>')}}async function loadImg(e){const t='<img onclick="unloadImg()" src="'+myWH[e][7]+'" class="nft">';if($("#breed1").is(":empty"))$("#breed1").html(t),breed1=myWH[e][8],hideOwls(e);else{if(!$("#breed2").is(":empty"))return;$("#breed2").html(t),breed2=myWH[e][8],hideOwls(e)}$("#breed1").is(":empty")||$("#breed2").is(":empty")||($("#breed").show(),await contract.methods.gen(parseInt(myWH[e][3])+1).call().then(e=>{$("#lblBreed").html("("+e[1]+"/"+e[0]+")")}),gen=parseInt(myWH[e][3])+1)}async function hideOwls(e){for(let t=0;t<myWH.length;t++)myWH[t][4]!=myWH[e][4]&&myWH[t][3]==myWH[e][3]||$("#o"+myWH[t][8]).hide(),myWH[t][0]==myWH[e][8]&&$("#o"+myWH[t][1]).hide(),myWH[t][1]==myWH[e][8]&&$("#o"+myWH[t][0]).hide()}async function unloadImg(){$("#breed1").empty(),$("#breed2").empty(),$("#lblBreed").empty(),breed1=null,breed2=null,$("#breed").hide();for(let e=0;e<myWH.length;e++)$("#o"+myWH[e][8]).show()}async function getCurrentAccount(){return(await web3.eth.getAccounts())[0]}async function getCID(){var e;sex=Math.floor(2*Math.random()),await $.getJSON("https://aloycwl.github.io/WhooliHootie/img.json",function(t){e=t.g[gen].s[sex]});const t=await new Promise(t=>{const n=new FileReader;n.onloadend=(()=>{ipfs.add(ipfs.Buffer.from(n.result)).then(e=>{t(e)})}),n.readAsArrayBuffer(new File([JSON.stringify({name:"Whooli Hootie #"+(parseInt(count)+1),description:"We are a green chip NFT that gives passive income and many offline perks. Find another gender to breed your baby owl now!",image:"ipfs://"+e,date:Date.now(),attributes:[{trait_type:"Generation",value:gen},{trait_type:"Gender",value:0==sex?"Female":"Male"},{trait_type:"Parent1",value:null==breed1?"":"WHCC #"+breed1},{trait_type:"Parent2",value:null==breed2?"":"WHCC #"+breed2}]})],"application/json"))});cid=t[0].hash}async function MINT(){gen=1,await getCID(),await contract.methods.MINT(sex,cid).send({from:await getCurrentAccount(),gas:25e4,value:0}),location.reload()}async function BREED(){await getCID(),await contract.methods.BREED(breed1,breed2,sex,cid).send({from:await getCurrentAccount(),gas:4e5,value:0}),location.reload()}async function load(){ethereum&&(web3=new Web3(ethereum),await window.ethereum.request({method:"eth_requestAccounts"})),4!=await web3.eth.net.getId()?(await ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x4"}]}),location.reload()):(contract=new web3.eth.Contract([{inputs:[{internalType:"address",name:"_a",type:"address"},{internalType:"uint256",name:"_s",type:"uint256"},{internalType:"string",name:"_i",type:"string"}],name:"AIRDROP",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{inputs:[{internalType:"address",name:"_t",type:"address"},{internalType:"uint256",name:"_c",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_1",type:"uint256"},{internalType:"uint256",name:"_2",type:"uint256"},{internalType:"uint256",name:"_s",type:"uint256"},{internalType:"string",name:"_i",type:"string"}],name:"BREED",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"DISTRIBUTE",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_c",type:"uint256"},{internalType:"uint256",name:"_x",type:"uint256"}],name:"GENPREP",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_s",type:"uint256"},{internalType:"string",name:"_i",type:"string"}],name:"MINT",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_f",type:"address"},{internalType:"address",name:"_t",type:"address"},{internalType:"uint256",name:"_c",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_f",type:"address"},{internalType:"address",name:"_t",type:"address"},{internalType:"uint256",name:"_c",type:"uint256"},{internalType:"bytes",name:"_d",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_p",type:"uint256"}],name:"setPercent",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"_f",type:"address"},{internalType:"address",name:"_t",type:"address"},{internalType:"uint256",name:"_c",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"count",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"gen",outputs:[{internalType:"uint256",name:"maxCount",type:"uint256"},{internalType:"uint256",name:"currentCount",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_c",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getBalance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_a",type:"address"}],name:"getWallet",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"owl",outputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"parent1",type:"uint256"},{internalType:"uint256",name:"parent2",type:"uint256"},{internalType:"uint256",name:"time",type:"uint256"},{internalType:"uint256",name:"gen",type:"uint256"},{internalType:"uint256",name:"sex",type:"uint256"},{internalType:"string",name:"cid",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_c",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes4",name:"_t",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"pure",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"tokens",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_c",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}],"0xAEd04EEfEcd6dFd10e1d7E337DcE933b63980913"),$("#name").append(await contract.methods.name.call().call()+" - "+await contract.methods.getBalance.call().call()+" balance"),await contract.methods.gen(1).call().then(e=>{$("#mint").append(e[1]+"/"+e[0]+")")}),count=await contract.methods.count.call().call())}var loaded=!1;async function isWeb3(){await web3.eth.getAccounts().then(e=>{e.length>0?($("#connect").hide(),$("#root").show(),0==loaded&&(loadMyOwl(),loaded=!0)):($("#connect").show(),$("#root").hide())})}load(),setInterval(isWeb3,2e3);
