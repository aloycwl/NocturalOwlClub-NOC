var nfts,breed1,breed2,gen,sex,cid,count,acct,loaded,owlWallet,img;async function loadMyOwl(){(nfts=await contract.methods.PLAYERITEMS(acct[0]).call())[7]=new Array;for(let e=0;e<nfts[0].length;e++)nfts[7][e]=img[nfts[3][e]][nfts[4][e]],$("#myWH").append(`<p id="o${nfts[5][e]}" class="boxnft"><b>Whooli Hootie #${nfts[5][e]}</b><br/>Parents : ${nfts[0][e]} + ${nfts[1][e]}<br/>Last breeded: ${nfts[2][e]>0?moment(moment.unix(nfts[2][e])).fromNow():"Since forever"}<br/>Generation: ${nfts[3][e]} (${0==nfts[4][e]?"Female":"Male"})<br/><video autoplay loop muted src="https://ipfs.io/ipfs/${nfts[7][e]}${moment.duration(moment().diff(moment(moment.unix(nfts[2][e])))).asSeconds()>0&&1==nfts[6][e]?`" onclick="loadImg(${e})" class="nft`:'" class="nobreed'}"></video></p> `)}async function loadImg(e){const t=`<video autoplay loop muted onclick="unloadImg()" src="https://ipfs.io/ipfs/${nfts[7][e]}" class="nft"></video>`;if($("#breed1").is(":empty"))$("#breed1").html(t),breed1=nfts[5][e],hideOwls(e);else{if(!$("#breed2").is(":empty"))return;$("#breed2").html(t),breed2=nfts[5][e],hideOwls(e)}$("#breed1").is(":empty")||$("#breed2").is(":empty")||($("#breed").show(),await contract.methods.gen(parseInt(nfts[3][e])+1).call().then(e=>{$("#lblBreed").html(`(${e[1]}/${e[0]})`)}),gen=parseInt(nfts[3][e])+1)}async function hideOwls(e){for(let t=0;t<nfts[0].length;t++)nfts[4][t]!=nfts[4][e]&&nfts[3][t]==nfts[3][e]||$("#o"+nfts[5][t]).hide(),nfts[0][t]==nfts[5][e]&&$(`#o${nfts[1][t]}`).hide(),nfts[1][t]==nfts[5][e]&&$(`#o${nfts[0][t]}`).hide()}async function unloadImg(){$("#breed1").empty(),$("#breed2").empty(),$("#lblBreed").empty(),breed1=null,breed2=null,$("#breed").hide();for(let e=0;e<nfts[0].length;e++)$("#o"+nfts[5][e]).show()}async function getCID(){const e=IpfsApi({host:"ipfs.infura.io",port:5001,protocol:"https"});sex=Math.floor(2*Math.random());const t=await new Promise(t=>{const n=new FileReader;n.onloadend=(()=>{e.add(e.Buffer.from(n.result)).then(e=>{t(e)})}),n.readAsArrayBuffer(new File([JSON.stringify({name:`Whooli Hootie #${parseInt(count)+1}`,description:"We are a green chip NFT that gives passive income and many offline perks. Find another gender to breed your baby owl now!",animation_url:`ipfs://${img[gen][sex]}`,attributes:[{display_type:"number",trait_type:"Generation",value:gen},{trait_type:"Gender",value:0==sex?"Female":"Male"},{trait_type:"Parent 1",value:null==breed1?"":`WHCC #${breed1}`},{trait_type:"Parent 2",value:null==breed2?"":`WHCC #${breed2}`},{display_type:"date",trait_type:"Hatched on",value:Date.now()}]})],"application/json"))});cid=t[0].hash}async function MINT(){gen=1,await getCID(),await contract.methods.MINT(sex,cid).send({from:acct[0],value:0}),location.reload()}async function BREED(){owlWallet<30?$("#breed").html("Insufficient OWL Token"):(await getCID(),await contract.methods.BREED(breed1,breed2,sex,cid).send({from:acct[0]}),location.reload())}async function load(){img=$.getJSON("https://aloycwl.github.io/omg_frontend/whcc/js/img.min.json",function(e){img=e}),ethereum?(web3=new Web3(ethereum),acct=await ethereum.request({method:"eth_requestAccounts"}),4!=await web3.eth.net.getId()?(await ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x4"}]}),location.reload()):(contract=new web3.eth.Contract(abi,"0xD120D29947BCb41812Dc6e7AbA2782E7c8237F36"),await contract.methods.gen(1).call().then(e=>{$("#mint").append(`${e[1]} / ${e[0]} )`)}),count=await contract.methods.count.call().call(),contract2=new web3.eth.Contract(abi2,"0x34A85f092877F93584ab9f4fe9aE2FFA8C846B1F"),owlWallet=await contract2.methods.balanceOf(acct[0]).call()/1e18,$("#name").append(`${await contract.methods.getBalance.call().call()/1e18} balance. Owl Wallet: ${owlWallet}`),$("#connect").hide())):$("#connect").html("Please install Metamask")}async function isWeb3(){await web3.eth.getAccounts().then(e=>{e.length>0?($("#connect").hide(),$("#root").show(),loaded||(loadMyOwl(),loaded=!0)):($("#connect").show(),$("#root").hide(),$("#name").html("<b>Whooli Hootie </b>"),$("#mint").html("MINT ("))})}setInterval(isWeb3,1e3),load();